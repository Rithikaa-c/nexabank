<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Reset Admin Password - Nexa Bank</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #062045, #0a3781);
            font-family: "Segoe UI", sans-serif;
        }

        .box {
            width: 480px;
            background: rgba(255,255,255,0.12);
            backdrop-filter: blur(12px);
            border-radius: 22px;
            padding: 40px 45px;
            box-shadow: 0 0 40px rgba(0,0,0,0.35);
            border: 2px solid rgba(255,255,255,0.18);
            color: #fff;
        }

        h2 {
            text-align: center;
            font-size: 28px;
            font-weight: 700;
        }

        .sub {
            text-align: center;
            color: #d9e6ff;
            margin-bottom: 25px;
            font-size: 15px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #e8f1ff;
        }

        .input-group {
            position: relative;
            margin-bottom: 18px;
        }

        input {
            width: 100%;
            padding: 14px;
            padding-right: 55px;  /* FIX: reserve space so size never changes */
            border-radius: 12px;
            border: 1px solid #d4d9e3;
            font-size: 16px;
            outline: none;
            color: #062045;
            box-sizing: border-box; /* FIX: prevents resizing */
        }

        .eye {
            position: absolute;
            right: 15px;   /* FIXED POSITION */
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 20px;
            user-select: none;
            color: #f5c542;
        }

        .password-rules {
            margin-bottom: 12px;
            font-size: 14px;
        }

        .password-rules span {
            display: block;
        }

        .invalid { color: #ff8b8b; }
        .valid { color: #7dff7d; }

        .error, .success {
            text-align: center;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .error { color: #ff8b8b; }
        .success { color: #7dff7d; }

        button {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }

        .btn-update {
            background: #f7d65b;
            color: #1a1a1a;
        }
        .btn-update:hover {
            background: #ffe067;
        }

        .btn-back {
            background: #062045;
            color: white;
            border: 1px solid #1b3566;
        }
        .btn-back:hover {
            background: #0a2a63;
        }

    </style>
</head>

<body>

<div class="box">

    <h2>Reset Password</h2>
    <p class="sub">Create a strong and secure password</p>

    <p class="success" th:if="${success}" th:text="${success}"></p>
    <p class="error" th:if="${error}" th:text="${error}"></p>

    <form method="post" action="/admin/reset-password" id="pwdForm">

        <label>New Password</label>
        <div class="input-group">
            <input type="password" id="newPass" name="newPassword" required>
            <span class="eye" onclick="toggleEye('newPass', this)">üôà</span>
        </div>

        <label>Confirm Password</label>
        <div class="input-group">
            <input type="password" id="confirmPass" name="confirmPassword" required>
            <span class="eye" onclick="toggleEye('confirmPass', this)">üôà</span>
        </div>

        <div class="password-rules">
            <span id="rule1" class="invalid">‚Ä¢ Minimum 8 characters</span>
            <span id="rule2" class="invalid">‚Ä¢ At least one uppercase letter (A-Z)</span>
            <span id="rule3" class="invalid">‚Ä¢ At least one lowercase letter (a-z)</span>
            <span id="rule4" class="invalid">‚Ä¢ At least one number (0-9)</span>
            <span id="rule5" class="invalid">‚Ä¢ At least one special character (! @ # $ % ?)</span>
        </div>

        <p id="matchError" class="error"></p>

        <button type="submit" class="btn-update">Update Password</button>
    </form>

    <form th:action="@{/admin-login}">
        <button type="submit" class="btn-back">‚Üê Back to Login</button>
    </form>

</div>

<script>
    function toggleEye(id, icon) {
        const field = document.getElementById(id);
        const hidden = field.type === "password";

        field.type = hidden ? "text" : "password";
        icon.textContent = hidden ? "üëÅÔ∏è" : "üôà";
    }

    const newPass = document.getElementById("newPass");
    newPass.addEventListener("input", validatePassword);

    function validatePassword() {
        const val = newPass.value;

        document.getElementById("rule1").className = val.length >= 8 ? "valid" : "invalid";
        document.getElementById("rule2").className = /[A-Z]/.test(val) ? "valid" : "invalid";
        document.getElementById("rule3").className = /[a-z]/.test(val) ? "valid" : "invalid";
        document.getElementById("rule4").className = /\d/.test(val) ? "valid" : "invalid";
        document.getElementById("rule5").className = /[!@#$%^&*?_]/.test(val) ? "valid" : "invalid";
    }

    document.getElementById("pwdForm").addEventListener("submit", function (e) {
        const p1 = newPass.value;
        const p2 = document.getElementById("confirmPass").value;

        const matchErr = document.getElementById("matchError");
        matchErr.textContent = "";

        if (p1 !== p2) {
            matchErr.textContent = "Passwords do not match!";
            e.preventDefault();
            return;
        }

        const rulesOk =
            document.getElementById("rule1").className === "valid" &&
            document.getElementById("rule2").className === "valid" &&
            document.getElementById("rule3").className === "valid" &&
            document.getElementById("rule4").className === "valid" &&
            document.getElementById("rule5").className === "valid";

        if (!rulesOk) {
            matchErr.textContent = "Password does not meet security requirements.";
            e.preventDefault();
        }
    });
</script>

</body>
</html>
