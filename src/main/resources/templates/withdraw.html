<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Withdraw Money - Nexa Bank</title>

    <audio id="successSound">
        <source src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" type="audio/mpeg">
    </audio>

    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: #f4f7fc;
        }

        .navbar {
            background-color: #0d1b3d;
            color: #f7d65b;
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
        }

        .container {
            width: 45%;
            margin: 40px auto;
            background: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        input, select, textarea {
            width: 95%;
            padding: 14px;
            border: 2px solid #cfd5e3;
            border-radius: 8px;
            font-size: 16px;
        }

        /* PIN boxes */
        .pin-container {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .pin-input {
            width: 30px;
            height: 30px;
            font-size: 22px;
            text-align: center;
            border: 2px solid #cfd5e3;
            border-radius: 8px;
        }
.pin-container {
    margin-bottom: 2px;
}

        .pin-input:focus { border-color: #0d1b3d; }
.show-pin-row {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-top: 4px;
    margin-bottom: 6px;
    width: max-content;
}
.show-pin-row input {
    margin: 0;
    padding: 0;
}

.show-pin-row label {
    margin: 0;
    padding: 0;
    line-height: 1; /* removes extra height */
    white-space: nowrap;
}
.show-pin-row {
    white-space: nowrap;
}


        /* SUCCESS & ERROR */
        .success-box {
            margin-top: 25px;
            padding: 18px;
            border-radius: 10px;
            background-color: #e8f7e8;
            color: #0a7b0a;
            border-left: 5px solid #0a7b0a;
        }

        .error-box {
            margin-top: 25px;
            padding: 18px;
            border-left: 5px solid red;
            background-color: #ffe6e6;
            color: red;
            border-radius: 10px;
            font-weight: 600;
        }

        /* RECEIPT */
        #receipt-box {
            margin-top: 25px;
            border-left: 5px solid #0d1b3d;
            padding: 20px;
            border-radius: 12px;
            background: #ffffff !important;
        }

        #receipt-box * {
            color: #000 !important;
            font-weight: 600;
        }

        /* FIX âœ” MAKE DOWNLOAD WHITE */
        #receipt-box .download-btn,
        #receipt-box .download-btn * {
            color: #ffffff !important;
        }

        /* DOWNLOAD BUTTON */
        .download-btn {
            margin-top: 15px;
            width: 100%;
            padding: 14px;
            background-color: #0d1b3d !important;
            color: #ffffff !important;
            border: none;
            border-radius: 8px;
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            text-transform: uppercase;
            text-align: center;
        }

        /* ACTION BUTTONS */
        .button-row {
            display: flex;
            gap: 20px;
            margin-top: 25px;
        }

        .equal-btn {
            width: 50%;
            padding: 14px;
            background-color: #f7d65b;
            color: #0d1b3d;
            font-weight: 700;
            border-radius: 10px;
            border: none;
            cursor: pointer;
        }

        .equal-btn-link {
            width: 50%;
            padding: 14px;
            background-color: #0d1b3d;
            color: #fff !important;
            font-weight: 700;
            border-radius: 10px;
            text-decoration: none;
            display:flex;
            justify-content:center;
            align-items:center;
        }

    </style>
</head>

<body>

<div class="navbar">NEXA BANK</div>

<div class="container">

    <h2>Withdraw Money</h2>
    <div class="subtitle">Secure â€” Fast â€” Trusted</div>

    <div th:if="${success}" class="success-box">
        âœ” <strong th:text="${success}"></strong>
    </div>

    <div th:if="${error}" class="error-box">
        <strong th:text="${error}"></strong>
    </div>

    <!-- Receipt -->
    <div th:if="${transactionId}" id="receipt-box">
        <h3>ðŸ§¾ Nexa Bank - Withdrawal Receipt</h3>

        <p><strong>Transaction ID:</strong> <span th:text="${transactionId}"></span></p>
        <p><strong>Date:</strong> <span th:text="${date}"></span></p>
        <p><strong>Time:</strong> <span th:text="${time}"></span></p>
        <p><strong>Account Number:</strong> <span th:text="${accountNumber}"></span></p>
        <p><strong>Holder Name:</strong> <span th:text="${holderName}"></span></p>
        <p><strong>Amount Withdrawn:</strong> â‚¹<span th:text="${amount}"></span></p>
        <p><strong>Reason:</strong> <span th:text="${reason}"></span></p>
        <p><strong>New Balance:</strong> â‚¹<span th:text="${updatedBalance}"></span></p>

        <button onclick="downloadPDF()" class="download-btn">DOWNLOAD RECEIPT (PDF)</button>
    </div>

    <form th:action="@{'/withdraw'(accountNumber=${accountNumber})}" method="post" onsubmit="return validatePin()">

        <label><strong>Enter Amount</strong></label>
        <input type="number" name="amount" min="1" required>

        <label style="margin-top:12px;"><strong>Enter PIN</strong></label>

        <!-- PIN -->
        <div class="pin-container">
            <input type="password" maxlength="1" class="pin-input">
            <input type="password" maxlength="1" class="pin-input">
            <input type="password" maxlength="1" class="pin-input">
            <input type="password" maxlength="1" class="pin-input">
        </div>

        <!-- FIX âœ” TOGETHER IN ONE LINE, NEAR BOXES -->
        <div class="show-pin-row">
            <input type="checkbox" id="showPinCheckbox" onclick="togglePinVisibility()">
            <label for="showPinCheckbox">Show PIN</label>
        </div>

        <input type="hidden" name="pin" id="fullPin">

        <label><strong>Reason (Optional)</strong></label>
        <select id="reasonSelect" name="reason" onchange="toggleOtherReason()">
            <option value="" selected>No Reason</option>
            <option value="Personal Expense">Personal Expense</option>
            <option value="Shopping">Shopping</option>
            <option value="Rent Payment">Rent Payment</option>
            <option value="Bill Payment">Bill Payment</option>
            <option value="Emergency Expense">Emergency Expense</option>
            <option value="Medical Expense">Medical Expense</option>
            <option value="Other">Other</option>
        </select>

        <input type="text" id="otherReasonInput" name="otherReason"
               placeholder="Enter custom reason" style="display:none;">

        <div class="button-row">
            <button class="equal-btn">Withdraw â‚¹</button>
            <a th:href="@{'/dashboard'(accountNumber=${accountNumber})}" class="equal-btn-link">
                Back to Dashboard
            </a>
        </div>
    </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    function togglePinVisibility() {
        const show = document.getElementById("showPinCheckbox").checked;
        document.querySelectorAll(".pin-input").forEach(i => {
            i.type = show ? "text" : "password";
        });
    }

    function validatePin() {
        let pin = "";
        document.querySelectorAll(".pin-input").forEach(i => pin += i.value);
        if (pin.length !== 4) {
            alert("Please enter 4-digit PIN");
            return false;
        }
        document.getElementById("fullPin").value = pin;
        return true;
    }

    function toggleOtherReason() {
        document.getElementById("otherReasonInput").style.display =
            (document.getElementById("reasonSelect").value === "Other") ? "block" : "none";
    }
    // AUTO MOVE BETWEEN PIN BOXES
document.querySelectorAll(".pin-input").forEach((box, index, inputs) => {

    box.addEventListener("input", () => {
        if (box.value.length === 1 && index < inputs.length - 1) {
            inputs[index + 1].focus();
        }
    });

    box.addEventListener("keydown", (e) => {
        if (e.key === "Backspace" && box.value === "" && index > 0) {
            inputs[index - 1].focus();
        }
    });
});

</script>

</body>
</html>
