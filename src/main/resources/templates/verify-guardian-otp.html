<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Guardian OTP Verification</title>

    <style>
        body{
            background: linear-gradient(135deg,#0d1b3d,#1d3a73);
            height:100vh;
            display:flex;
            justify-content:center;
            align-items:center;
            font-family:Segoe UI, sans-serif;
            color:#fff;
            margin:0;
        }

        .otp-box{
            width:450px;
            background:#ffffff;
            color:#0d1b3d;
            padding:40px 35px;
            border-radius:20px;
            text-align:center;
            box-shadow:0 0 40px rgba(255,255,255,0.25);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn{
            from{opacity:0; transform:scale(0.97);}
            to{opacity:1; transform:scale(1);}
        }

        h2{ margin-bottom:10px; font-weight:700; }

        .email-info{
            font-size:15px;
            font-weight:600;
            color:#1f3c66;
            margin-bottom:20px;
        }

        .otp-container {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 25px 0;
        }

        .otp-input {
            width: 48px;
            height: 58px;
            border: 2px solid #cfd7e3;
            border-radius: 10px;
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            outline: none;
            transition: 0.2s;
        }

        .otp-input:focus {
            border-color:#1f3c66;
            box-shadow:0 0 8px rgba(31,60,102,0.4);
        }

        .btn{
            width:100%;
            padding:14px;
            border:none;
            border-radius:10px;
            font-size:18px;
            font-weight:600;
            cursor:pointer;
        }

        .btn-verify{ background:#f5c542; margin-top:15px; }
        .btn-resend{ background:#1f3c66; color:white; margin-top:15px; }

        .timer{ color:red; font-weight:600; margin-top:10px; }

        .msg{ margin-top:10px; font-weight:600; }
        .red{ color:red; }
        .green{ color:green; }
    </style>
</head>

<body>

<div class="otp-box">

    <h2>Enter OTP</h2>
    <p class="email-info">
        Sent to Guardian: <span th:text="${email}"></span>
    </p>

    <!-- VERIFY FORM -->
    <form th:action="@{/minor/verify-guardian-otp}" method="post">

        <input type="hidden" name="email" th:value="${email}">
        <input type="hidden" name="minorEmail" th:value="${minorEmail}">
        <input type="hidden" name="otp" id="finalOtp">

        <div class="otp-container">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
        </div>

        <button type="submit" class="btn btn-verify">Verify</button>

        <p class="msg red" th:if="${error}" th:text="${error}"></p>
        <p class="msg green" th:if="${message}" th:text="${message}"></p>

        <p id="timer" class="timer">OTP expires in 02:00</p>
    </form>

    <!-- RESEND OTP FORM -->
    <form th:action="@{/minor/guardian-resend-otp}" method="post">

        <input type="hidden" name="email" th:value="${email}">
        <input type="hidden" name="minorEmail" th:value="${minorEmail}">

        <button type="submit" class="btn btn-resend">Resend OTP</button>
    </form>

</div>

<script>
    const inputs = document.querySelectorAll(".otp-input");
    const finalOtp = document.getElementById("finalOtp");

    inputs.forEach((box, index) => {
        box.addEventListener("input", () => {
            if (box.value.length === 1 && index < inputs.length - 1)
                inputs[index + 1].focus();

            let otp = "";
            inputs.forEach(b => otp += b.value);
            finalOtp.value = otp;
        });

        box.addEventListener("keydown", (e) => {
            if (e.key === "Backspace" && box.value === "" && index > 0)
                inputs[index - 1].focus();
        });
    });

    let time = 120;
    const timer = document.getElementById("timer");

    const countdown = setInterval(() => {
        let m = Math.floor(time / 60);
        let s = String(time % 60).padStart(2,'0');

        if(time > 0){
            timer.textContent = `OTP expires in ${m}:${s}`;
        } else {
            timer.textContent = "OTP expired! Please resend.";
            clearInterval(countdown);
        }

        time--;
    }, 1000);
</script>

</body>
</html>
